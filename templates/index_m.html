<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Instagram-like Page</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <style>
    .follow:hover{
        color: #333;
    }
    .follow{
        color: #0095F6;
        font-size: 14px;
    }
    
    .zhaopian{
        width: 300px; 
        height: 300px; 
        overflow: hidden;
        margin-left: 10px;
    }
         .center-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .center-button {
            font-size: 18px;
            padding: 12px 25px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            transition: 0.3s;
            margin: 10px; /* 按钮之间的间距 */
        }
        .center-button:hover {
            background-color: #0056b3;
        }
    /* 全局样式 */
    .heart {
            width: 100px;
            height: 100px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        /* 定义点击后的特效样式 */
    .heart.clicked {
            transform: scale(1.2);
        }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      background-color:white;
    }

    /* 导航栏样式 */
    nav {
      position: fixed;
        font-size: 15px;
      background-color:white;
      padding: 20px;
      width: 300px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      border-right: 1px #DBDBDB solid;
    }

    nav ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    nav ul li {
      margin-bottom: 30px;
    }

    nav ul li a {
      text-decoration: none;
      color: #333;
      display: flex;
      align-items: center;
    }

    nav ul li a img {
      width: 29px;
      height: 28px;
      margin-right: 10px;
    }

    /* 内容展示区样式 */
   .content {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #bottom_nav{
        position: fixed;
            bottom: 0;
            left: 0;

            text-align: center;
            padding: 10px;
    }
    .video{

      display: flex;
           
    }
    .post{
      display: flex;
      margin-top: 10px;
      margin-left: 40%;
    }
    .left_side{
    
      margin-left: 6px;
      width: 340px;
    }
    .header{
      display: flex;
      height: 64px;
      width: 340px;
      border: 1px #DBDBDB solid;
    }
    .comment{
      width: 100%;
      max-width: 400px;
      height: 380px;
      background-color: white;

      
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px #DBDBDB solid;
    }
    .add_comment{
      height: 160px;
      width: 340px;
      border: 1px #DBDBDB solid;
    }
    .header_img{
      margin:10px;
    }
    .header_text p{
      margin-top: 18px;
      margin-bottom: 0px;
      font-size: 14px;
    }
    .comment-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .comment-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            position: relative;
        }
        
        .comment-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .comment-content-wrapper {
            flex: 1;
            padding-right: 30px;
        }
        
        .comment-user {
            font-weight: bold;
            color: black;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .comment-text {
            color: #333;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        
        .comment-time {
            font-size: 12px;
            color: #999;
        }
        
        .like-btn {
            position: absolute;
            right: 0;
            bottom: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #ccc;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .like-btn.liked {
            color: #ff6b6b;
        }
        
        .like-count {
            font-size: 12px;
            color: #999;
            margin-left: 3px;
        }
        
        /* 滚动条样式 */
        .comment-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .comment-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .comment-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        .comment-list::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }
        .add_comment_icon{
          display: flex;
          margin: 10px;
          
        }
        .add_comment_icon img{
          width: 25px;
          height: 25px;
          margin-left: 13px;
        }
        .input_comment{
          margin-left: 10px;
          margin-top: 30px;
          display: flex;
        }
        #comment_input{
          margin-left: 10px;
          font-size: 18px;
          border: 1px solid white;
          height: 30px;
          width: 200px;
        }
        #header2{
            display: none;
        }
        #send_img{
          position: absolute;
            margin-left: 270px;
        }
        #send_comment{
          display: none;
          margin-top: 5px;
          color: #0095F6;
        }
        #send_comment:hover{
          color: black;
        }
  </style>
    <style>
        :root {
            --ig-primary: #702EF9;
            --ig-secondary: #702EF9;
            --ig-purple: #702EF9;
            --ig-pink: #702EF9;
            --ig-red: #702EF9;
            --ig-orange: #702EF9;
            --ig-yellow: #962fbf;
            --ig-gradient: linear-gradient(45deg, 
                var(--ig-primary), 
                var(--ig-secondary), 
                var(--ig-purple), 
                var(--ig-pink), 
                var(--ig-red), 
                var(--ig-orange), 
                var(--ig-yellow));
        }


        .chat-container {
            margin-left: 40%;
            width: 100%;
            max-width: 830px;
            height: 610px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;

        }

        .chat-messages {

            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 20px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            background: var(--ig-gradient);
            opacity: 0.8;
            border-bottom-right-radius: 4px;
            color: white;
        }

        .message.received {

            align-self: flex-start;
            background:  #EEEEEE;
            color: black;
            border-bottom-left-radius: 4px;
            margin-left: 40px;
        }

        .message.received .avatar {
            position: absolute;

            left: -45px;
            top: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .message-time {
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.7;
            text-align: right;
        }

        .chat-input-container {
            padding: 12px;
            border-top: 1px solid #efefef;
            display: flex;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            background-color: #f0f0f0;
            font-size: 20px;
            outline: none;
            transition: all 0.2s;
        }

        .chat-input:focus {
            background-color: #e0e0e0;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--ig-gradient);
            opacity: 0.9;
            border: none;
            color: white;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* 对方正在输入动画 */
        .typing-indicator {
            align-self: flex-start;
            background-color: #efefef;
            padding: 10px 14px;
            border-radius: 18px;
            margin-bottom: 12px;
            display: inline-flex;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
            border-bottom-left-radius: 4px;
            margin-left: 40px;
            position: relative;
        }

        .typing-indicator .avatar {
            position: absolute;
            left: -45px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background-color:#999;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-5px);
            }
        }

        /* 滚动条样式 */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .text-center{
          margin-left: 45%;
        }
        #img_t{
            width:100px;
        }
        #header3{
            display:none;
        }
        .xiangce{
            margin-left:38%;
            
        }
        .xiangce_img{
            display: flex;
            
        } 
        .xiangce_img img{
            width:300px;
            height:400px;
        } 
        video{

            height: 610px;
        }
        
    </style>
    <style>
         @media (max-width: 1640px) {
        .content {
            transform: scale(0.8); /* 比如缩小到 80% 大小 */
            transform-origin: top left; /* 缩放以左上角为基准 */
        }
            .zhaopian{
        width: 450px; 
        height: 300px; 
        overflow: hidden;
        margin-left: 10px;
    }
            .content {
      margin-left: -100px;
    }
                nav {
    background-color:white;
        width: 200px;

    }
            .text-center{
            width: 800px;
            }
            #bottom_nav{
                display: none;
            }
            .content{
            position:absolute;
          
            left: 5vw;
        }        

         }
        @media (max-width: 1240px) {
        .xiangce{
            width: 80%;

            
        }
         .zhaopian{
        width: 400px; 
        height: 250px; 
        }
        .nav{
            transform: scale(0.8); /* 比如缩小到 80% 大小 */
            transform-origin: top left;
            position: fixed;
        }    
        .content {
            transform: scale(0.8); /* 比如缩小到 80% 大小 */
            transform-origin: top left; /* 缩放以左上角为基准 */
        }
        .content{
            position:absolute;
            margin-left: 0;
            margin-right: 0;
            top: -30px;
            width: 100%;
            max-width: 90vw;
            left: 0vw;
        }         
         }
        @media (max-width: 1000px) {
        .content {
            transform: scale(0.6); /* 比如缩小到 80% 大小 */
            transform-origin: top left; /* 缩放以左上角为基准 */
            top: 0px;
            left: 10vw;

        }
        .nav{
            transform: scale(0.6); /* 比如缩小到 80% 大小 */
            transform-origin: top left;
            position: fixed;
        } 
        .xiangce{
            width: 100%;

            
        }
         .zhaopian{
        width: 400px; 
        height: 250px; 
        }
    }

    @media (max-width: 480px) {
        .message.received {
            width: 100%;
        }
        .content {
            transform: scale(1); /* 比如缩小到 80% 大小 */
            transform-origin: top left; /* 缩放以左上角为基准 */
        }
        .xiangce{
            width: 110%;
        
        }
        .zhaopian{
        width: 400px; 
        height: 150px; 
        }
        .message {
            max-width: 70%;
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 20px;
            line-height: 1.2;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
        }

        .like-btn {         
            right: 20px;
        }
        #header2{
            display: flex;
        }
        #header1{
            display: none;
        }
        nav{
            display: none;
        }
        .content{
            position:absolute;
            margin-left: 0;
            margin-right: 0;
            top: -30px;
            width: 100%;
            max-width: 90vw;
            left: -40vw;
        }
        video{
            width: 100vw;
        }
        .post{
            display:inline;
        }
        .left_side{
            margin-left: 0px;
            width: 100vw;
        }
        .header{
            width: 100vw;
        }
        .comment {
            width: 100%;
            max-width: 100vw;
        }
        .comment-list{
            width: 120%;
            max-width: 100vw;
        }
        .add_comment{
            width: 100vw;
        }
        .comment-text{
            font-size: 16px;
        }
        .comment-user {
            font-size: 16px;
        }
        .text-center{
          margin-left:  200px;
          margin-right: auto;
          width: 300px;
        }
        .text-center h1{
            font-size: 15px;
        }
        #img_t{
            width:60px;
        }
        .chat-container {
           
            width: 99.5vw;
            max-width: 480px;
            height: 800px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;

        }
        #header3{
            display: flex;
        }
        #send_img{
            margin-left: 320px;
        }
        .chat-input {

            font-size: 20px;

        }
    }
    </style>
    <style>

  @media (max-width: 480px) {
   .chat-container {
           

            height: 500px;


        }
  }

</style>
<style>
    .hid{
        display: none;
    }
</style>
</head>

<body>


  <div class="center-container" style="display:none;">
    
    <h1>Please click this button to finish the remaining questions in the survey.</h1>
    <a href="https://wkwsci.co1.qualtrics.com/jfe/form/SV_cYcmEElk7rdt9gG"><button class="center-button" >Back to qualtrics</button></a>
</div>
  <!-- 导航栏 -->
  <nav class="nav" id="nav">
    <br>
    <div id="logo"><img src="{{ url_for('static',filename='img/logo.png')}}" width="115px;"></div>
    <br><br><br>
    <ul>
       
      <li><a href="#"><img src="{{ url_for('static',filename='img/home-icon.png')}}" alt="Home"> Home</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/search-icon.png')}}" alt="Search"> Search</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/explore-icon.png')}}" alt="Explore"> Explore</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/reels-icon.png')}}"alt="Reels"> Reels</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/messages-icon.png')}}" alt="Messages"> Messages</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/notifications-icon.png')}}" alt="Notifications"> Notifications</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/create-icon.png')}}" alt="Create"> Create</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/profile-icon.png')}}" alt="Profile"> Profile</a></li>
    </ul>
    <ul id="bottom_nav">
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/ai-studio-icon.png')}}" alt="AI Studio"> AI Studio</a></li>
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/threads-icon.png')}}" alt="Threads"> Threads</a></li>
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/more-icon.png')}}" alt="More"> More</a></li>
    </ul>
  </nav>

  <!-- 内容展示区 -->
  <div class="content">
    <!-- 单个帖子 -->
    <div class="post">
        <div class="header" id="header2">
            <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
            <div class="header_text"><p><b>Jasmyn &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;<b style="color: gray;">•</b>&nbsp;<b class="follow" onclick="toggleFollow(this)">Follow</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;">Original audio</p></div>
          </div>
      <div class="video"><video src="{{ url_for('static',filename='img/vedio.mp4')}}" poster="{{ url_for('static',filename='img/loading2.png')}}"  autoplay muted loop playsinline></video> </div>
      <div class="left_side">
          <div class="header" id="header1">
              <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
              <div class="header_text"><p><b>Jasmyn &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;<b style="color: gray;">•</b>&nbsp;<b class="follow" onclick="toggleFollow(this)">Follow</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;">Original audio</p></div>
          </div>
          <div class="comment">
            <div class="comment-list" id="commentList">
              <!-- 评论将通过JS动态加载 -->
          </div>
          </div>
          <div class="add_comment">
            <div class="add_comment_icon">
              <img id="heartImg" class="heart" src="{{ url_for('static',filename='img/love.png') }}" alt="爱心" onclick="toggleHeart()">
            </div>
            <div class="add_comment_text">
              <p style="font-size: 14px;margin: 10px;">Liked by <b>wakaba_uro0702</b> and <b>others</b></p>
              <p style="font-size: 12px;margin: 10px;color: #999;">June 20, 2025</p>
            </div>
            <div class="input_comment">
              <img src="{{ url_for('static',filename='img/profile-icon.png')}}" width="35px;" height="35px;" alt="">

                <textarea  type="text" id="comment_input" placeholder="Add a comment..." onclick="post_send_btn()"></textarea>
                

              <p id="send_comment" onclick="send_cm()">&nbsp; post</p>
            </div>
          </div>
      </div>
    </div>
    <hr>

    
    <br><br><br>
    <div class="text-center hid">
      <h1>Scroll down to talk with me!</h1>
      <img src="{{ url_for('static',filename='img/down.gif')}}" style="margin-left: 25%;" id="img_t"  >
    </div>
    <br>
    
    <div class="chat-container hid" id="chat_layout">
        <div class="header" id="header3" >
            <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
            <div class="header_text"><p><b>Jasmyn &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;color: rgb(58, 224, 58);">Online</p></div>
        </div>
      <div class="chat-messages" id="chatMessages">
          <!-- 消息将通过JS动态添加 -->
      </div>
      <div class="chat-input-container">
          <textarea  type="text" class="chat-input" id="messageInput" placeholder="Send message..." autocomplete="off"></textarea>
          <button class="send-button" id="sendButton">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
          </button>
      </div>
  </div>
      <div class="xiangce">
        <p>More posts from Jasmyn.gram</p>
        <div class="xiangce_img">
        <div class="zhaopian" >
            <img src="{{ url_for('static',filename='img/post_img.png')}}" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="zhaopian">
            <img src="{{ url_for('static',filename='img/post_img2.png')}}" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="zhaopian">
            <img src="{{ url_for('static',filename='img/post_img3.png')}}" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <!-- <img src="{{ url_for('static',filename='img/post_img2.png')}}"  alt="">
        <img src="{{ url_for('static',filename='img/post_img3.png')}}" alt=""> -->
        </div>
    </div>
  </div>


  <script> 
  
  var user_list=[];
  var chat_list=[];
  var comment_list=[];
  var like_status='no';
  var follow_status='no'
  var ip='';
  var flow_dit={
    'failflow1':["It seems that you haven't answered my question","May I know which country you live in?"],
    'failflow2':["It seems that you haven't answered my question","What topic are you interested in on social media?","For example, my interest is music."],
  }

  var flow_status=1
  var country=''
  </script>
  <script>
  function toggleFollow(element) {
    if (element.innerText === "Follow") {
      element.innerText = "Following";
      element.style.color = "black";
      follow_status='yes'
    } else {
      element.innerText = "Follow";
      element.style.color = "#0095F6"; // 清除样式，恢复默认颜色
      follow_status='no'
    }
  }
</script>
  <script>
function onScroll() {
if (document.documentElement.scrollTop >= 200) {
    messageInput.readOnly = true;
    addMessage('received', 'Hi there, nice to meet you. I’m Jasmyn, a virtual influencer!', getCurrentTime());
        // 模拟初始对话
    setTimeout(() => {
        addMessage('received', 'I’d love to know a bit more about you. Could you tell me which country you’re from?', getCurrentTime());
        messageInput.readOnly = false;
    }, 3000);
    window.removeEventListener('scroll', onScroll); // 只启动一次倒计时，移除事件监听
}

}
 window.addEventListener('scroll', onScroll);

     window.addEventListener('load', () => {
      console.log('已禁止滚动，20 秒后解锁');

      setTimeout(() => {
        document.querySelectorAll('.hid').forEach(el => {
        el.classList.remove('hid');
        });
      }, 15000);
    });
</script>
  <script>
    const enter_time = new Date().toLocaleString('en-US', {
  month: 'short',    // "Jul"
  day: '2-digit',    // "10"
  year: 'numeric',   // "2025"
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit',
  hour12: false
    });
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    let isTyping = false;
    let typingIndicator = null;
    
    // 发送消息函数
    function sendMessage() {
        if (window.innerWidth <= 480) {
      chatContainer.style.height='800px';
        scrollToHeader3();

//     window.scrollTo({
//     top: document.documentElement.scrollHeight,
//     behavior: 'smooth'
//   });
    }
        const message = messageInput.value.trim();
        user_list.push("User say: " + message);
        if (message !== '') {
            addMessage('sent', message, getCurrentTime());
            msg=messageInput.value
            messageInput.value = '';

            showTypingIndicator();
            messageInput.readOnly = true; 
          
            $.ajax({
                type: 'POST',
                url: '/get_message',
                contentType: 'application/json',  // 设置请求的Content-Type为application/json
                data: JSON.stringify({ 
                    message:  msg, 
                    flow_status:flow_status,
                }),
                success: function(response) {
                    
                    if(response.message == 'ban_word'){
                        alert('It is detected that you have entered prohibited words. Please have a proper conversation with the chatbot.');
                        hideTypingIndicator();
                        deleteLastMessage();
                        messageInput.readOnly = false;
                        return 0;

                    }
                    // else if(response.message == 'yes' ){
                    //     var flow='successflow'+flow_status.toString();
                    //     flow_status=2;                        
                    //     async function showMessagesSequentially(messages) {
                    //         for (const message of messages) {
                    //             showTypingIndicator();
                    //             await new Promise(resolve => setTimeout(resolve, 3000)); // 等待2秒
                    //             hideTypingIndicator();
                    //             addMessage('received', message, getCurrentTime());
                    //             chat_list.push("Chat bot say: " + message);
                    //         }
                    //     }
                    //     showMessagesSequentially(flow_dit[flow]);
                    //     first_s=1;

                    // }else if(response.message == 'no'){
                    //     var flow='success2flow'+flow_status.toString();                        
                    //     flow_status=2;  
                    //     async function showMessagesSequentially(messages) {
                    //         for (const message of messages) {
                    //             showTypingIndicator();
                    //             await new Promise(resolve => setTimeout(resolve, 3000)); // 等待2秒
                    //             hideTypingIndicator();
                    //             addMessage('received', message, getCurrentTime());
                    //             chat_list.push("Chat bot say: " + message);
                    //         }
                    //     }
                    //     showMessagesSequentially(flow_dit[flow]);
                    //     first_s=2;
   
                    // }
                    else if(response.message.toLowerCase().includes("redo")){

                        var flow='failflow'+flow_status.toString();
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 3000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push("Chat bot say: " + message);
                            }
                        }

                        async function handleConversationFlow() {
                            await showMessagesSequentially(flow_dit[flow]);
                            messageInput.readOnly = false; // 等待 showMessagesSequentially 执行完之后再设置为 false
                        }

                    }else{
                        
                        interest_talk=['Thank you for sharing you interests!',
                                        'If you haven’t followed my official account yet, don’t forget to hit that follow button. Let’s explore the world together!'];
                        country_talk=["Thanks for sharing where you're from!","Now, what kinds of topics are you interested in on social media? For example, you might say, “I’m into music!”"];
                        if (flow_status==1){
                            talk=country_talk
                            country=response.message
                        }else{
                            talk=interest_talk
                        }
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 3000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push("Chat bot say: " + message);
                            }
                        }
                        
                        async function handleConversationFlow() {
                            await showMessagesSequentially(talk);
                            messageInput.readOnly = false; // 等待 showMessagesSequentially 执行完之后再设置为 false
                            if(flow_status>=2){
                            messageInput.readOnly = true; 
                            var finnish_time=new Date().toLocaleString('en-US', {
                            month: 'short',    // "Jul"
                            day: '2-digit',    // "10"
                            year: 'numeric',   // "2025"
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false
                            });
                            var data_dict={};
                            data_dict['finnish_time']=finnish_time;
                            data_dict['enter_time']=enter_time;
                            data_dict['user_message']=user_list;
                            data_dict['chatbot_message']=chat_list;
                            data_dict['like_status']=like_status;
                            data_dict['comment_list']=comment_list;
                            data_dict['follow']=follow_status;
                            fetch('https://api.ipify.org?format=json')
                            .then(response => response.json())
                            .then(data => {
                                data_dict['IP'] =  String(data.ip); 
                                fetch("/save_chat2", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify(data_dict)
                                })
                                .then(response => response.json())
                                .then(result => {
                                console.log("服务器返回：", result);
                                });                                                   
                            })
                            .catch(error => {
                                console.error('获取IP失败:', error);
                            });
                    

                            
                            countdown = 20;
                            setInterval(() => {
                            const timer = setInterval(() => {
                            if (countdown > 0) {
                                messageInput.readOnly = true; 
                                messageInput.placeholder = `The conversation has ended. Please wait and we will direct you to finish the remaining questions in the survey.`;
                                countdown--;                                
                            } else {
                                // document.getElementById("nav").style.display = "none";

                                // document.querySelectorAll(".content").forEach(element => {
                                //     element.style.display = "none";
                                // });
                                // document.querySelectorAll(".center-container").forEach(element => {
                                //     element.style.display = "inline";
                                // });
                                window.parent.postMessage({ action: "closeIframe", status: "done" }, "*");
                                clearInterval(timer);

                            }
                            }, 1000);},10000);

                        }
                        flow_status=2;
                        }

                        handleConversationFlow();
                        
                        
                    }
                    
  

                },
                error: function(xhr, status, error) {
                    console.error("Error: ", error);
                    alert('An error occurred');
                }
            });

        }

    }

    // 显示"对方正在输入"指示器
    function showTypingIndicator() {
        if (isTyping) return;

        isTyping = true;
        typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing-indicator';
        typingIndicator.innerHTML = `
            <img class="avatar" src="{{ url_for('static',filename='img/header.png')}}" alt="头像">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // 隐藏"对方正在输入"指示器
    function hideTypingIndicator() {
        if (!isTyping) return;

        if (typingIndicator && typingIndicator.parentNode) {
            typingIndicator.parentNode.removeChild(typingIndicator);
        }
        isTyping = false;
    }

    // 添加消息到聊天窗口   
    function addMessage(type, text, time) {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${type}`;
        if (type === 'received') {
            messageElement.innerHTML = `
                <img class="avatar" src="{{ url_for('static',filename='img/header.png')}}" alt="头像">
                ${text}
                <div class="message-time">${time}</div>
            `;
        } else {
            messageElement.innerHTML = `
                ${text}
                <div class="message-time">${time}</div>
            `;
        }
        chatMessages.appendChild(messageElement);

        // 滚动到底部
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    function deleteLastMessage() {
    const messages = document.querySelectorAll('.message');
    if (messages.length > 0) {
        const lastMessage = messages[messages.length - 1];
        lastMessage.remove();
    }
    }
    // 获取当前时间
    function getCurrentTime() {
        const now = new Date();
        return `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
    }
    // 事件监听
    sendButton.addEventListener('click', sendMessage);

    document.getElementById('messageInput').addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
        sendMessage();
        this.blur();
    }
    });
    document.getElementById('comment_input').addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
       send_cm();
    }
    });




</script>
  <script>
    // 模拟评论数据
    const comments = [
        {
            id: 1,
            user: "Jasmyn.gram &nbsp;<img src='{{ url_for('static',filename='img/correct.png')}}' width='16px;' >&nbsp;<b style='color: gray;''>",
            avatar: "{{ url_for('static',filename='img/header.png')}}",
            content: "Thank you for witnessing my debut on Instagram! My name is Jasmyn. 🌟<br><br>Also, I am so excited to be a new headphone brand -- FunPlay’s first-ever virtual ambassador! 🎧🩵<br><br>FunPlay is all about embracing the pleasure of music and having fun! 😄🎵💃<br><br><span style='color: blue;''>#VirtualInfluencer #Jasmyn #FunPlay #MusicFun</span>",
            time: "2025-06-20 10:30",
            likes: 5,
            isLiked: false
        },
        {
            id: 2,
            user: "yyasuj",
            avatar: "https://t1.tp88.net/tp88/uploads/allimg/2306/co230623094353-2.jpg",
            content: "🥰🥰🥰👏👏👏",
            time: "2025-06-21 14:15",
            likes: 3,
            isLiked: false
        },
        {
            id: 3,
            user: "ryopaa728",
            avatar: "https://i.pinimg.com/originals/de/0a/c4/de0ac4cb6e85a9406e55fa7cda6a1264.jpg",
            content: "❤️❤️❤️",
            time: "2025-06-22 09:45",
            likes: 8,
            isLiked: false
        },
    ];
    // 获取评论列表容器
    const commentList = document.getElementById('commentList');

    // 渲染评论
    function renderComments() {
        commentList.innerHTML = '';
        comments.forEach(comment => {
            const commentItem = document.createElement('div');
            commentItem.className = 'comment-item';
            commentItem.innerHTML = `
                <img src=${comment.avatar} alt="${comment.user}" class="user-avatar">
                <div class="comment-content-wrapper">
                    <div class="comment-user">${comment.user}</div>
                    <div class="comment-text">${comment.content}</div>
                    <div class="comment-time">${comment.time}</div>
                </div>
                <button class="like-btn ${comment.isLiked ? 'liked' : ''}" data-id="${comment.id}">
                    ♥ <span class="like-count">${comment.likes}</span>
                </button>
            `;
            commentList.appendChild(commentItem);
        });
        
        // 添加点赞事件监听
        document.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const commentId = parseInt(this.getAttribute('data-id'));
                const comment = comments.find(c => c.id === commentId);
                
                if (comment.isLiked) {
                    comment.likes--;
                    comment.isLiked = false;
                    this.classList.remove('liked');
                } else {
                    comment.likes++;
                    comment.isLiked = true;
                    this.classList.add('liked');
                }
                
                this.querySelector('.like-count').textContent = comment.likes;
            });
        });
    }

    // 初始化渲染
    renderComments();

    // // 模拟动态添加新评论（可选）
    // setInterval(() => {
    //     const gender = Math.random() > 0.5 ? 'men' : 'women';
    //     const randomId = Math.floor(Math.random() * 100);
        
    //     const newComment = {
    //         id: comments.length + 1,
    //         user: "用户" + Math.floor(Math.random() * 1000),
    //         avatar: `https://randomuser.me/api/portraits/${gender}/${randomId}.jpg`,
    //         content: "这是新添加的评论，内容自动生成。",
    //         time: new Date().toLocaleString(),
    //         likes: 0,
    //         isLiked: false
    //     };
    //     comments.push(newComment);
    //     renderComments();
    //     // 自动滚动到底部
    //     commentList.scrollTop = commentList.scrollHeight;
    // }, 10000); // 每10秒添加一条新评论
</script>
  <script>
        async function getUserIP() {
            try {
                // 使用ipify API获取用户IP（纯文本格式）
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                ip=data.ip;
                data_dict['IP']=ip;
            } catch (error) {
                console.error('获取IP失败:', error);
            }
            return ip
        }
  </script>
  <script>
        function toggleHeart() {
            const heartImg = document.getElementById('heartImg');
            // 添加点击特效类
            heartImg.classList.add('clicked');

            if(String(heartImg.src).slice(-8)=="love.png"){
              heartImg.src = "{{ url_for('static',filename='img/loved.png') }}";
              like_status="yes";
            }else{
              heartImg.src = "{{ url_for('static',filename='img/love.png') }}";
              like_status="no";
            }
            
            // 延迟恢复特效类（可选，让用户看到放大效果）
            setTimeout(() => {
                heartImg.classList.remove('clicked');
            }, 300);
        }
         function post_send_btn() {
            const post_send_btn = document.getElementById('send_comment');
            
            post_send_btn .style.display = "inline";
        }
        function send_cm(){
  
            if( document.getElementById("comment_input").value.trim()!=""){
            comment_answer=document.getElementById("comment_input").value
            $.ajax({
                type: 'POST',
                url: '/comment',
                contentType: 'application/json',  // 设置请求的Content-Type为application/json
                data: JSON.stringify({ 
                    message: comment_answer, 
                }),
                success: function(response) {
                    if(response.message == 'ban_word'){
                        alert('It is detected that you have entered prohibited words. Please have a proper conversation with the chatbot.');
                    }else{
                        comment_list.push(comment_answer);
                
                
                        const newComment = {
                            id: comments.length + 1,
                            user: "User" ,
                            avatar: `{{ url_for('static',filename='img/profile-icon.png')}}`,
                            content: comment_answer,
                            time: new Date().toLocaleString(),
                            likes: 0,
                            isLiked: false
                        };
                        comments.push(newComment);
                        renderComments();
                        // // 自动滚动到底部
                        commentList.scrollTop = commentList.scrollHeight;
                    }
                    
                }
            });
                    
            document.getElementById("comment_input").value = "";}
        }
</script>
<script>
  const input = document.getElementById('messageInput');
  const chatContainer = document.getElementById('chat_layout');
  input.addEventListener('focus', () => {
    if (window.innerWidth <= 480 && flow_status==1) {
      chatContainer.style.height='500px';
    }
  });

</script>
<script>
  function scrollToHeader3() {
    const header = document.getElementById("header3");
    if (header) {
      header.scrollIntoView({ behavior: "smooth" }); // 或 "auto"
    }
  }
  

  // 调用这个函数，在发送消息后
 
</script>
</body>

</html>