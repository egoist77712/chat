<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Instagram-like Page</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <style>
         .center-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .center-button {
            font-size: 18px;
            padding: 12px 25px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            transition: 0.3s;
            margin: 10px; /* 按钮之间的间距 */
        }
        .center-button:hover {
            background-color: #0056b3;
        }
    /* 全局样式 */
    .heart {
            width: 100px;
            height: 100px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        /* 定义点击后的特效样式 */
    .heart.clicked {
            transform: scale(1.2);
        }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
    }

    /* 导航栏样式 */
    nav {
      position: fixed;
        font-size: 15px;
      background-color: #f8f9fa;
      padding: 20px;
      width: 300px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      border-right: 1px #DBDBDB solid;
    }

    nav ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    nav ul li {
      margin-bottom: 30px;
    }

    nav ul li a {
      text-decoration: none;
      color: #333;
      display: flex;
      align-items: center;
    }

    nav ul li a img {
      width: 29px;
      height: 28px;
      margin-right: 10px;
    }

    /* 内容展示区样式 */
   .content {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #bottom_nav{
        position: fixed;
            bottom: 0;
            left: 0;

            text-align: center;
            padding: 10px;
    }
    .video{

      display: flex;
           
    }
    .post{
      display: flex;
      margin-top: 10px;
      margin-left: 40%;
    }
    .left_side{
    
      margin-left: 6px;
      width: 340px;
    }
    .header{
      display: flex;
      height: 64px;
      width: 340px;
      border: 1px #DBDBDB solid;
    }
    .comment{
      width: 100%;
      max-width: 400px;
      height: 380px;
      background-color: white;

      
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px #DBDBDB solid;
    }
    .add_comment{
      height: 160px;
      width: 340px;
      border: 1px #DBDBDB solid;
    }
    .header_img{
      margin:10px;
    }
    .header_text p{
      margin-top: 18px;
      margin-bottom: 0px;
      font-size: 14px;
    }
    .comment-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .comment-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            position: relative;
        }
        
        .comment-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .comment-content-wrapper {
            flex: 1;
            padding-right: 30px;
        }
        
        .comment-user {
            font-weight: bold;
            color: black;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .comment-text {
            color: #333;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        
        .comment-time {
            font-size: 12px;
            color: #999;
        }
        
        .like-btn {
            position: absolute;
            right: 0;
            bottom: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #ccc;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .like-btn.liked {
            color: #ff6b6b;
        }
        
        .like-count {
            font-size: 12px;
            color: #999;
            margin-left: 3px;
        }
        
        /* 滚动条样式 */
        .comment-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .comment-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .comment-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        .comment-list::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }
        .add_comment_icon{
          display: flex;
          margin: 10px;
          
        }
        .add_comment_icon img{
          width: 25px;
          height: 25px;
          margin-left: 13px;
        }
        .input_comment{
          margin-left: 10px;
          margin-top: 30px;
          display: flex;
        }
        #comment_input{
          margin-left: 10px;
          border: 1px solid white;
          height: 30px;
        }
        #header2{
            display: none;
        }
        #send_img{
          position: absolute;
            margin-left: 270px;
        }
        #send_comment{
          display: none;
          margin-top: 5px;
          color: #0095F6;
        }
        #send_comment:hover{
          color: black;
        }
  </style>
    <style>
        :root {
            --ig-primary: #702EF9;
            --ig-secondary: #702EF9;
            --ig-purple: #702EF9;
            --ig-pink: #702EF9;
            --ig-red: #702EF9;
            --ig-orange: #702EF9;
            --ig-yellow: #962fbf;
            --ig-gradient: linear-gradient(45deg, 
                var(--ig-primary), 
                var(--ig-secondary), 
                var(--ig-purple), 
                var(--ig-pink), 
                var(--ig-red), 
                var(--ig-orange), 
                var(--ig-yellow));
        }


        .chat-container {
            margin-left: 40%;
            width: 100%;
            max-width: 830px;
            height: 610px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;

        }

        .chat-messages {

            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 20px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            background: var(--ig-gradient);
            opacity: 0.8;
            border-bottom-right-radius: 4px;
            color: white;
        }

        .message.received {
            align-self: flex-start;
            background:  #EEEEEE;
            color: black;
            border-bottom-left-radius: 4px;
            margin-left: 40px;
        }

        .message.received .avatar {
            position: absolute;
            left: -45px;
            top: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .message-time {
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.7;
            text-align: right;
        }

        .chat-input-container {
            padding: 12px;
            border-top: 1px solid #efefef;
            display: flex;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            background-color: #f0f0f0;
            font-size: 20px;
            outline: none;
            transition: all 0.2s;
        }

        .chat-input:focus {
            background-color: #e0e0e0;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--ig-gradient);
            opacity: 0.9;
            border: none;
            color: white;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* 对方正在输入动画 */
        .typing-indicator {
            align-self: flex-start;
            background-color: #efefef;
            padding: 10px 14px;
            border-radius: 18px;
            margin-bottom: 12px;
            display: inline-flex;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
            border-bottom-left-radius: 4px;
            margin-left: 40px;
            position: relative;
        }

        .typing-indicator .avatar {
            position: absolute;
            left: -45px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background-color:#999;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-5px);
            }
        }

        /* 滚动条样式 */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .text-center{
          margin-left: 45%;
        }
        #img_t{
            width:100px;
        }
        #header3{
            display:none;
        }
        .xiangce{
            margin-left:38%;
            
        }
        .xiangce_img{
            display: flex;
            
        } 
        .xiangce_img img{
            width:300px;
            height:400px;
        } 

        
    </style>
    <style>
         @media (max-width: 1640px) {
            #bottom_nav{
                display: none;
            }
            .content{
            position:absolute;
          
            left: 5vw;
        }           
         }
        @media (max-width: 1240px) {
        nav{
            display: none;
        }
        .content{
            position:absolute;
            margin-left: 0;
            margin-right: 0;
            top: -30px;
            width: 100%;
            max-width: 90vw;
            left: -20vw;
        }         
         }
        @media (max-width: 1000px) {
        .message {
            max-width: 50%;
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.2;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
        }
        #send_img{
            margin-left: 25vw;
        }
        .like-btn {         
            right: 20px;
        }
        #header2{
            display: flex;
        }
        #header1{
            display: none;
        }
        nav{
            display: none;
        }
        .content{
            position:absolute;
            margin-left: 0;
            margin-right: 0;
            top: -30px;
            width: 100%;
            max-width: 90vw;
            left: -20vw;
        }
        video{
            width: 100vw;
        }
        .post{
            display:inline;
        }
        .left_side{
            margin-left: 0px;
            width: 63vw;
        }
        .header{
            width: 63vw;
        }
        .comment {
            width: 100%;
            max-width: 100vw;
        }
        .comment-list{
            width: 120%;
            max-width: 100vw;
        }
        .add_comment{
            width: 63vw;
        }
        .comment-text{
            font-size: 8px;
        }
        .comment-user {
            font-size: 12px;
        }
        .text-center{
          margin-left:  350px;
          margin-right: auto;
          width: 300px;
        }
        .text-center h1{
            font-size: 15px;
        }
        #img_t{
            width:60px;
        }
        .chat-container {
           
            width: 99.5vw;
            max-width: 480px;
            height: 400px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;

        }
        #header3{
            display: flex;
        }
        #send_img{
            margin-left: 370px;
        }
    }

        @media (max-width: 680px) {
        .xiangce_img img{
            width:200px;
            height:266px;
        } 
        .message {
            max-width: 50%;
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 20px;
            line-height: 1.2;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
        }
        #send_img{
            margin-left: 25vw;
        }
        .like-btn {         
            right: 20px;
        }
        #header2{
            display: flex;
        }
        #header1{
            display: none;
        }
        nav{
            display: none;
        }
        .content{
            position:absolute;
            margin-left: 0;
            margin-right: 0;
            top: -30px;
            width: 100%;
            max-width: 90vw;
            left: -40vw;
        }
        video{
            width: 100vw;
        }
        .post{
            display:inline;
        }
        .left_side{
            margin-left: 0px;
            width: 100vw;
        }
        .header{
            width: 100vw;
        }
        .comment {
            width: 100%;
            max-width: 100vw;
        }
        .comment-list{
            width: 120%;
            max-width: 100vw;
        }
        .add_comment{
            width: 100vw;
        }
        .comment-text{
            font-size: 8px;
        }
        .comment-user {
            font-size: 12px;
        }
        .text-center{
          margin-left:  200px;
          margin-right: auto;
          width: 300px;
        }
        .text-center h1{
            font-size: 15px;
        }
        #img_t{
            width:60px;
        }
        .chat-container {
           
            width: 99.5vw;
            max-width: 480px;
            height: 800px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;

        }
        #header3{
            display: flex;
        }
        #send_img{
            margin-left: 370px;
        }
        .chat-input {

            font-size: 20px;

        }
    }
    </style>
    <style>


  @media (max-width: 680px) {
   .chat-container {
           

            height: 500px;


        }
  }

</style>

</head>

<body>
  <div class="center-container" style="display:none;">
    
    <h1>Congratulations! You have completed the AI chatbot experience. Please click on the button to return to qualtrics to complete the questionnaire</h1>
    <a href="https://wkwsci.co1.qualtrics.com/jfe/form/SV_cYcmEElk7rdt9gG"><button class="center-button" >Back to qualtrics</button></a>
</div>
  <!-- 导航栏 -->
  <nav class="nav" id="nav">
    <br>
    <div id="logo"><img src="{{ url_for('static',filename='img/logo.png')}}" width="115px;"></div>
    <br><br><br>
    <ul>
       
      <li><a href="#"><img src="{{ url_for('static',filename='img/home-icon.png')}}" alt="Home"> Home</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/search-icon.png')}}" alt="Search"> Search</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/explore-icon.png')}}" alt="Explore"> Explore</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/reels-icon.png')}}"alt="Reels"> Reels</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/messages-icon.png')}}" alt="Messages"> Messages</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/notifications-icon.png')}}" alt="Notifications"> Notifications</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/create-icon.png')}}" alt="Create"> Create</a></li>
      <li><a href="#"><img src="{{ url_for('static',filename='img/profile-icon.png')}}" alt="Profile"> Profile</a></li>
    </ul>
    <ul id="bottom_nav">
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/ai-studio-icon.png')}}" alt="AI Studio"> AI Studio</a></li>
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/threads-icon.png')}}" alt="Threads"> Threads</a></li>
      <li><a href="#">&nbsp;<img src="{{ url_for('static',filename='img/more-icon.png')}}" alt="More"> More</a></li>
    </ul>
  </nav>

  <!-- 内容展示区 -->
  <div class="content">
    <!-- 单个帖子 -->
    <div class="post">
        <div class="header" id="header2">
            <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
            <div class="header_text"><p><b>busima &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;<b style="color: gray;">•</b>&nbsp;<b style="color: #0095F6; font-size: 12px;">Follow</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;">Original audio</p></div>
        </div>
      <div class="video"><video src="{{ url_for('static',filename='img/vedio.mp4')}}" autoplay muted loop></video> </div>
      <div class="left_side">
          <div class="header" id="header1">
              <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
              <div class="header_text"><p><b>busima &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;<b style="color: gray;">•</b>&nbsp;<b style="color: #0095F6; font-size: 12px;">Follow</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;">Original audio</p></div>
          </div>
          <div class="comment">
            <div class="comment-list" id="commentList">
              <!-- 评论将通过JS动态加载 -->
          </div>
          </div>
          <div class="add_comment">
            <div class="add_comment_icon">
              <img id="heartImg" class="heart" src="{{ url_for('static',filename='img/love.png') }}" alt="爱心" onclick="toggleHeart()">
              <img src="{{ url_for('static',filename='img/cm_ic.png')}}" alt="">
              <img src="{{ url_for('static',filename='img/fly.png')}}" alt="">
              <img src="{{ url_for('static',filename='img/flag.png')}}" style="margin-left: 50%;" alt="">
            </div>
            <div class="add_comment_text">
              <p style="font-size: 14px;margin: 10px;">Liked by <b>wakaba_uro0702</b> and <b>others</b></p>
              <p style="font-size: 12px;margin: 10px;color: #999;">June 14, 2023</p>
            </div>
            <div class="input_comment">
              <img src="{{ url_for('static',filename='img/profile-icon.png')}}" width="35px;" height="35px;" alt="">
              <form action="">
                <input type="text" id="comment_input" placeholder="Add a comment..." onclick="post_send_btn()">
                
              </form>
              <p id="send_comment" onclick="send_cm()">&nbsp; post</p>
              <img src="{{ url_for('static',filename='img/smile.png')}}" width="26px;" height="27px;" id="send_img" alt="">
            </div>
          </div>
      </div>
    </div>
    <hr>
    <div class="xiangce">
        <p>More posts from imma.gram</p>
        <div class="xiangce_img">
        <img src="{{ url_for('static',filename='img/post_img.png')}}" alt="">
        <img src="{{ url_for('static',filename='img/post_img2.png')}}"  alt="">
        <img src="{{ url_for('static',filename='img/post_img3.png')}}" alt="">
        </div>
    </div>
    
    <br><br><br>
    <div class="text-center">
      <h1>Scroll down to interact with the chat bot</h1>
      <img src="{{ url_for('static',filename='img/down.gif')}}" style="margin-left: 25%;" id="img_t"  >
    </div>
    <br>
    
    <div class="chat-container" id="chat_layout">
        <div class="header" id="header3" >
            <div class="header_img"><img src="{{ url_for('static',filename='img/header.png')}}" width="44px" alt=""></div>
            <div class="header_text"><p><b>busima &nbsp;</b><img src="{{ url_for('static',filename='img/correct.png')}}" width="16px;" alt="">&nbsp;<b style="color: gray;">•</b>&nbsp;<b style="color: #0095F6; font-size: 12px;">Follow</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="img/more.png" width="20px" alt=""></p><p style="margin-top: 0px;font-size: 12px;color: rgb(58, 224, 58);">Online</p></div>
        </div>
      <div class="chat-messages" id="chatMessages">
          <!-- 消息将通过JS动态添加 -->
      </div>
      <div class="chat-input-container">
          <textarea  type="text" class="chat-input" id="messageInput" placeholder="Send message..." autocomplete="off"></textarea>
          <button class="send-button" id="sendButton">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
          </button>
      </div>
  </div>
  </div>
  <script> 
  
  var user_list=[];
  var chat_list=[];
  var comment_list=[];
  var like_status='no';
  var ip='';
  var flow_dit={
    'successflow1':['Okay. you <b style="color:#702EF9;">did</b> enjoy reading my previous post.',"What kind of content are you interested in on social media?","For example, my interest is music. "],
    'failflow1':["Sorry, it seems that you haven't answered my question","Did you enjoy reading my previous post?"],
    'successflow2':['Okay.',"Please follow my official account if you haven’t. Let’s explore this world together!"],
    'failflow2':["Sorry, it seems that you haven't answered my question","What kind of content are you interested in on social media?","For example, my interest is music. "],
    'success2flow1':['Okay. you <b style="color:#702EF9;">didn’t</b> enjoy reading my previous post.',"What kind of content are you interested in on social media?","For example, my interest is music. "],
  }

  var flow_status=1
  </script>
  <script>
function onScroll() {
if (document.documentElement.scrollTop >= 200) {
    addMessage('received', 'Hi there, nice to meet you. My name is Imma, a virtual influencer!', getCurrentTime());
        // 模拟初始对话
    setTimeout(() => {
        addMessage('received', 'Did you enjoy reading my previous post?', getCurrentTime());
    }, 1500);
    window.removeEventListener('scroll', onScroll); // 只启动一次倒计时，移除事件监听
}

}
 window.addEventListener('scroll', onScroll);
</script>
  <script>
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    let isTyping = false;
    let typingIndicator = null;
    var first_s=0;
    
    // 发送消息函数
    function sendMessage() {
        if (window.innerWidth <= 680) {
      chatContainer.style.height='800px';
    window.scrollTo({
    top: document.documentElement.scrollHeight,
    behavior: 'smooth'
  });
    }
        const message = messageInput.value.trim();
        user_list.push(message);
        if (message !== '') {
            addMessage('sent', message, getCurrentTime());
            msg=messageInput.value
            messageInput.value = '';

            showTypingIndicator();

          
            $.ajax({
                type: 'POST',
                url: '/get_message',
                contentType: 'application/json',  // 设置请求的Content-Type为application/json
                data: JSON.stringify({ 
                    message:  msg, 
                    flow_status:flow_status,
                }),
                success: function(response) {
                    
                    if(response.message == 'ban_word'){
                        alert('It is detected that you have entered prohibited words. Please have a proper conversation with the chatbot.');
                    }
                    else if(response.message == 'yes' ){
                        var flow='successflow'+flow_status.toString();
                        flow_status=2;                        
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 2000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push(message);
                            }
                        }
                        showMessagesSequentially(flow_dit[flow]);
                        first_s=1;
   
                    }else if(response.message == 'no'){
                        var flow='success2flow'+flow_status.toString();                        
                        flow_status=2;  
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 2000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push(message);
                            }
                        }
                        showMessagesSequentially(flow_dit[flow]);
                        first_s=2;
   
                    }
                    else if(response.message.toLowerCase().includes("redo")){

                        var flow='failflow'+flow_status.toString();
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 2000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push(message);
                            }
                        }

                        showMessagesSequentially(flow_dit[flow]);

                    }else{
                        if (first_s==1) {
                            last_talk=['Okay. You are interested in content about <b style="color:#702EF9;">'+response.message,'</b>Please follow my official account if you haven’t. Let’s explore this world together!','Thanks for sharing that you <b style="color:#702EF9;">did</b> enjoy reading my previous posts. <b style="color:#702EF9;">Because you mentioned that</b> you like topics about <b style="color:#702EF9;">'+response.message+'</b>, I will share more related content in the future.'];
                        }else if(first_s==2){
                            last_talk=['Okay. You are interested in content about <b style="color:#702EF9;">'+response.message,'</b>Please follow my official account if you haven’t. Let’s explore this world together!','Thanks for sharing that you <b style="color:#702EF9;">didn’t</b> enjoy reading my previous posts. <b style="color:#702EF9;">Because you mentioned that</b> you like topics about <b style="color:#702EF9;">'+response.message+'</b>, I will share more related content in the future.'];
                        }
                       
                        async function showMessagesSequentially(messages) {
                            for (const message of messages) {
                                showTypingIndicator();
                                await new Promise(resolve => setTimeout(resolve, 2000)); // 等待2秒
                                hideTypingIndicator();
                                addMessage('received', message, getCurrentTime());
                                chat_list.push(message);
                            }
                        }

                        showMessagesSequentially(last_talk);
                        if(flow_status>=2){
                            var data_dict={};
                            data_dict['user_message']=user_list;
                            data_dict['chatbot_message']=chat_list;
                            data_dict['like_status']=like_status;
                            data_dict['comment_list']=comment_list;                           
                            fetch('https://api.ipify.org?format=json')
                            .then(response => response.json())
                            .then(data => {
                                data_dict['IP'] =  String(data.ip); 
                                fetch("/save_chat", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify(data_dict)
                                })
                                .then(response => response.json())
                                .then(result => {
                                console.log("服务器返回：", result);
                                });                                                   
                            })
                            .catch(error => {
                                console.error('获取IP失败:', error);
                            });
                    

                            messageInput.readOnly = true; 
                            countdown = 15;
                            
                            const timer = setInterval(() => {
                            if (countdown > 0) {
                                messageInput.placeholder = ` Your reply has ended. We will redirect to the page in ${countdown} seconds`;
                                countdown--;
                            } else {
                                document.getElementById("nav").style.display = "none";

                                document.querySelectorAll(".content").forEach(element => {
                                    element.style.display = "none";
                                });
                                document.querySelectorAll(".center-container").forEach(element => {
                                    element.style.display = "inline";
                                });
                                clearInterval(timer);

                            }
                            }, 1000);

                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error: ", error);
                    alert('An error occurred');
                }
            });

        }

    }

    // 显示"对方正在输入"指示器
    function showTypingIndicator() {
        if (isTyping) return;

        isTyping = true;
        typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing-indicator';
        typingIndicator.innerHTML = `
            <img class="avatar" src="{{ url_for('static',filename='img/header.png')}}" alt="头像">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // 隐藏"对方正在输入"指示器
    function hideTypingIndicator() {
        if (!isTyping) return;

        if (typingIndicator && typingIndicator.parentNode) {
            typingIndicator.parentNode.removeChild(typingIndicator);
        }
        isTyping = false;
    }

    // 添加消息到聊天窗口   
    function addMessage(type, text, time) {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${type}`;
        if (type === 'received') {
            messageElement.innerHTML = `
                <img class="avatar" src="{{ url_for('static',filename='img/header.png')}}" alt="头像">
                ${text}
                <div class="message-time">${time}</div>
            `;
        } else {
            messageElement.innerHTML = `
                ${text}
                <div class="message-time">${time}</div>
            `;
        }
        chatMessages.appendChild(messageElement);

        // 滚动到底部
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // 获取当前时间
    function getCurrentTime() {
        const now = new Date();
        return `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
    }
    // 事件监听
    sendButton.addEventListener('click', sendMessage);


</script>
  <script>
    // 模拟评论数据
    const comments = [
        {
            id: 1,
            user: "busima &nbsp;<img src='{{ url_for('static',filename='img/correct.png')}}' width='16px;' >&nbsp;<b style='color: gray;''>•</b>&nbsp;<b style='color: #0095F6; font-size: 12px;'>Follow</b>",
            avatar: "{{ url_for('static',filename='img/header.png')}}",
            content: "这个产品非常好用，我已经用了三个月了，非常满意！",
            time: "2023-05-15 10:30",
            likes: 5,
            isLiked: false
        },
        {
            id: 2,
            user: "李四",
            avatar: "{{ url_for('static',filename='img/header.png')}}",
            content: "客服态度很好，解决问题很快，点赞！",
            time: "2023-05-16 14:15",
            likes: 3,
            isLiked: false
        },
        {
            id: 3,
            user: "王五",
            avatar: "{{ url_for('static',filename='img/header.png')}}",
            content: "物流速度很快，包装也很仔细，会继续支持的。",
            time: "2023-05-17 09:45",
            likes: 8,
            isLiked: false
        },
    ];
    // 获取评论列表容器
    const commentList = document.getElementById('commentList');

    // 渲染评论
    function renderComments() {
        commentList.innerHTML = '';
        comments.forEach(comment => {
            const commentItem = document.createElement('div');
            commentItem.className = 'comment-item';
            commentItem.innerHTML = `
                <img src=${comment.avatar} alt="${comment.user}" class="user-avatar">
                <div class="comment-content-wrapper">
                    <div class="comment-user">${comment.user}</div>
                    <div class="comment-text">${comment.content}</div>
                    <div class="comment-time">${comment.time}</div>
                </div>
                <button class="like-btn ${comment.isLiked ? 'liked' : ''}" data-id="${comment.id}">
                    ♥ <span class="like-count">${comment.likes}</span>
                </button>
            `;
            commentList.appendChild(commentItem);
        });
        
        // 添加点赞事件监听
        document.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const commentId = parseInt(this.getAttribute('data-id'));
                const comment = comments.find(c => c.id === commentId);
                
                if (comment.isLiked) {
                    comment.likes--;
                    comment.isLiked = false;
                    this.classList.remove('liked');
                } else {
                    comment.likes++;
                    comment.isLiked = true;
                    this.classList.add('liked');
                }
                
                this.querySelector('.like-count').textContent = comment.likes;
            });
        });
    }

    // 初始化渲染
    renderComments();

    // // 模拟动态添加新评论（可选）
    // setInterval(() => {
    //     const gender = Math.random() > 0.5 ? 'men' : 'women';
    //     const randomId = Math.floor(Math.random() * 100);
        
    //     const newComment = {
    //         id: comments.length + 1,
    //         user: "用户" + Math.floor(Math.random() * 1000),
    //         avatar: `https://randomuser.me/api/portraits/${gender}/${randomId}.jpg`,
    //         content: "这是新添加的评论，内容自动生成。",
    //         time: new Date().toLocaleString(),
    //         likes: 0,
    //         isLiked: false
    //     };
    //     comments.push(newComment);
    //     renderComments();
    //     // 自动滚动到底部
    //     commentList.scrollTop = commentList.scrollHeight;
    // }, 10000); // 每10秒添加一条新评论
</script>
  <script>
        async function getUserIP() {
            try {
                // 使用ipify API获取用户IP（纯文本格式）
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                ip=data.ip;
                data_dict['IP']=ip;
            } catch (error) {
                console.error('获取IP失败:', error);
            }
            return ip
        }
  </script>
  <script>
        function toggleHeart() {
            const heartImg = document.getElementById('heartImg');
            // 添加点击特效类
            heartImg.classList.add('clicked');

            if(String(heartImg.src).slice(-8)=="love.png"){
              heartImg.src = "{{ url_for('static',filename='img/loved.png') }}";
              like_status="yes";
            }else{
              heartImg.src = "{{ url_for('static',filename='img/love.png') }}";
              like_status="no";
            }
            
            // 延迟恢复特效类（可选，让用户看到放大效果）
            setTimeout(() => {
                heartImg.classList.remove('clicked');
            }, 300);
        }
         function post_send_btn() {
            const post_send_btn = document.getElementById('send_comment');
            
            post_send_btn .style.display = "inline";
        }
        function send_cm(){
            comment_list.push(document.getElementById("comment_input").value);
            
            
            const newComment = {
                id: comments.length + 1,
                user: "User" ,
                avatar: `{{ url_for('static',filename='img/profile-icon.png')}}`,
                content: document.getElementById("comment_input").value,
                time: new Date().toLocaleString(),
                likes: 0,
                isLiked: false
            };
            comments.push(newComment);
            renderComments();
            // 自动滚动到底部
            commentList.scrollTop = commentList.scrollHeight;
            document.getElementById("comment_input").value = "";
        }
</script>
<script>
  const input = document.getElementById('messageInput');
  const chatContainer = document.getElementById('chat_layout');
  input.addEventListener('focus', () => {
    if (window.innerWidth <= 680 && flow_status==1) {
      chatContainer.style.height='500px';
    }
  });

</script>

</body>

</html>